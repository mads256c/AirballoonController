package com.aatg.elev.bluetoothdebugger.dataconverters;

public class TemperatureConverter extends BaseDataConverter {

    public enum TemperatureUnit {
        Celsius, Kelvin, Fahrenheit
    }

    public static final double[] P100_TABLE = {
            18.49,
            18.93,
            19.36,
            19.79,
            20.22,
            20.65,
            21.08,
            21.51,
            21.94,
            22.37,
            22.8,
            23.23,
            23.66,
            24.09,
            24.52,
            24.94,
            25.37,
            25.8,
            26.23,
            26.65,
            27.08,
            27.5,
            27.93,
            28.35,
            28.78,
            29.2,
            29.63,
            30.05,
            30.47,
            30.9,
            31.32,
            31.74,
            32.16,
            32.59,
            33.01,
            33.43,
            33.85,
            34.27,
            34.69,
            35.11,
            35.53,
            35.95,
            36.37,
            36.79,
            37.21,
            37.63,
            38.04,
            38.46,
            38.88,
            39.3,
            39.71,
            40.13,
            40.55,
            40.96,
            41.38,
            41.79,
            42.21,
            42.63,
            43.04,
            43.45,
            43.87,
            44.28,
            44.7,
            45.11,
            45.52,
            45.94,
            46.35,
            46.76,
            47.18,
            47.59,
            48,
            48.41,
            48.82,
            49.23,
            49.64,
            50.06,
            50.47,
            50.88,
            51.29,
            51.7,
            52.11,
            52.52,
            52.92,
            53.33,
            53.74,
            54.15,
            54.56,
            54.97,
            55.38,
            55.78,
            56.19,
            56.6,
            57,
            57.41,
            57.82,
            58.22,
            58.63,
            59.04,
            59.44,
            59.85,
            60.25,
            60.66,
            61.06,
            61.47,
            61.87,
            62.28,
            62.68,
            63.09,
            63.49,
            63.9,
            64.3,
            64.7,
            65.11,
            65.51,
            65.91,
            66.31,
            66.72,
            67.12,
            67.52,
            67.92,
            68.33,
            68.73,
            69.13,
            69.53,
            69.93,
            70.33,
            70.73,
            71.13,
            71.53,
            71.93,
            72.33,
            72.73,
            73.13,
            73.53,
            73.93,
            74.33,
            74.73,
            75.13,
            75.53,
            75.93,
            76.33,
            76.73,
            77.13,
            77.52,
            77.92,
            78.32,
            78.72,
            79.11,
            79.51,
            79.91,
            80.31,
            80.7,
            81.1,
            81.5,
            81.89,
            82.29,
            82.69,
            83.08,
            83.48,
            83.88,
            84.27,
            84.67,
            85.06,
            85.46,
            85.85,
            86.25,
            86.64,
            87.04,
            87.43,
            87.83,
            88.22,
            88.62,
            89.01,
            89.4,
            89.8,
            90.19,
            90.59,
            90.98,
            91.37,
            91.77,
            92.16,
            92.55,
            92.95,
            93.34,
            93.73,
            94.12,
            94.52,
            94.91,
            95.3,
            95.69,
            96.09,
            96.48,
            96.87,
            97.26,
            97.65,
            98.04,
            98.44,
            98.83,
            99.22,
            99.61,
            100,
            100.39,
            100.78,
            101.17,
            101.56,
            101.95,
            102.34,
            102.73,
            103.12,
            103.51,
            103.9,
            104.29,
            104.68,
            105.07,
            105.46,
            105.85,
            106.24,
            106.63,
            107.02,
            107.4,
            107.79,
            108.18,
            108.57,
            108.96,
            109.35,
            109.73,
            110.12,
            110.51,
            110.9,
            111.28,
            111.67,
            112.06,
            112.45,
            112.83,
            113.22,
            113.61,
            113.99,
            114.38,
            114.77,
            115.15,
            115.54,
            115.93,
            116.31,
            116.7,
            117.08,
            117.47,
            117.85,
            118.24,
            118.62,
            119.01,
            119.4,
            119.78,
            120.16,
            120.55,
            120.93,
            121.32,
            121.7,
            122.09,
            122.47,
            122.86,
            123.24,
            123.62,
            124.01,
            124.39,
            124.77,
            125.16,
            125.54,
            125.92,
            126.31,
            126.69,
            127.07,
            127.45,
            127.84,
            128.22,
            128.6,
            128.98,
            129.37,
            129.75,
            130.13,
            130.51,
            130.89,
            131.27,
            131.66,
            132.04,
            132.42,
            132.8,
            133.18,
            133.56,
            133.94,
            134.32,
            134.7,
            135.08,
            135.46,
            135.84,
            136.22,
            136.6,
            136.98,
            137.36,
            137.74,
            138.12,
            138.5,
            138.88,
            139.26,
            139.64,
            140.02,
            140.39,
            140.77,
            141.15,
            141.53,
            141.91,
            142.29,
            142.66,
            143.04,
            143.42,
            143.8,
            144.17,
            144.55,
            144.93,
            145.31,
            145.68,
            146.06,
            146.44,
            146.81,
            147.19,
            147.57,
            147.94,
            148.32,
            148.7,
            149.07,
            149.45,
            149.82,
            150.2,
            150.57,
            150.95,
            151.33,
            151.7,
            152.08,
            152.45,
            152.83,
            153.2,
            153.58,
            153.95,
            154.32,
            154.7,
            155.07,
            155.45,
            155.82,
            156.19,
            156.57,
            156.94,
            157.31,
            157.69,
            158.06,
            158.43,
            158.81,
            159.18,
            159.55,
            159.93,
            160.3,
            160.67,
            161.04,
            161.42,
            161.79,
            162.16,
            162.53,
            162.9,
            163.27,
            163.65,
            164.02,
            164.39,
            164.76,
            165.13,
            165.5,
            165.87,
            166.24,
            166.61,
            166.98,
            167.35,
            167.72,
            168.09,
            168.46,
            168.83,
            169.2,
            169.57,
            169.94,
            170.31,
            170.68,
            171.05,
            171.42,
            171.79,
            172.16,
            172.53,
            172.9,
            173.26,
            173.63,
            174,
            174.37,
            174.74,
            175.1,
            175.47,
            175.84,
            176.21,
            176.57,
            176.94,
            177.31,
            177.68,
            178.04,
            178.41,
            178.78,
            179.14,
            179.51,
            179.88,
            180.24,
            180.61,
            180.97,
            181.34,
            181.71,
            182.07,
            182.44,
            182.8,
            183.17,
            183.53,
            183.9,
            184.26,
            184.63,
            184.99,
            185.36,
            185.72,
            186.09,
            186.45,
            186.82,
            187.18,
            187.54,
            187.91,
            188.27,
            188.63,
            189,
            189.36,
            189.72,
            190.09,
            190.45,
            190.81,
            191.18,
            191.54,
            191.9,
            192.26,
            192.63,
            192.99,
            193.35,
            193.71,
            194.07,
            194.44,
            194.8,
            195.16,
            195.52,
            195.88,
            196.24,
            196.6,
            196.96,
            197.33,
            197.69,
            198.05,
            198.41,
            198.77,
            199.13,
            199.49,
            199.85,
            200.21,
            200.57,
            200.93,
            201.29,
            201.65,
            202.01,
            202.36,
            202.72,
            203.08,
            203.44,
            203.8,
            204.16,
            204.52,
            204.88,
            205.23,
            205.59,
            205.95,
            206.31,
            206.67,
            207.02,
            207.38,
            207.74,
            208.1,
            208.45,
            208.81,
            209.17,
            209.52,
            209.88,
            210.24,
            210.59,
            210.95,
            211.31,
            211.66,
            212.02,
            212.37,
            212.73,
            213.09,
            213.44,
            213.8,
            214.15,
            214.51,
            214.86,
            215.22,
            215.57,
            215.93,
            216.28,
            216.64,
            216.99,
            217.35,
            217.7,
            218.05,
            218.41,
            218.76,
            219.12,
            219.47,
            219.82,
            220.18,
            220.53,
            220.88,
            221.24,
            221.59,
            221.94,
            222.29,
            222.65,
            223,
            223.35,
            223.7,
            224.06,
            224.41,
            224.76,
            225.11,
            225.46,
            225.81,
            226.17,
            226.52,
            226.87,
            227.22,
            227.57,
            227.92,
            228.27,
            228.62,
            228.97,
            229.32,
            229.67,
            230.02,
            230.37,
            230.72,
            231.07,
            231.42,
            231.77,
            232.12,
            232.47,
            232.82,
            233.17,
            233.52,
            233.87,
            234.22,
            234.56,
            234.91,
            235.26,
            235.61,
            235.96,
            236.31,
            236.65,
            237,
            237.35,
            237.7,
            238.04,
            238.39,
            238.74,
            239.09,
            239.43,
            239.78,
            240.13,
            240.47,
            240.82,
            241.17,
            241.51,
            241.86,
            242.2,
            242.55,
            242.9,
            243.24,
            243.59,
            243.93,
            244.28,
            244.62,
            244.97,
            245.31,
            245.66,
            246,
            246.35,
            246.69,
            247.04,
            247.38,
            247.72,
            248.07,
            248.41,
            248.76,
            249.1,
            249.45,
            249.79,
            250.13,
            250.48,
            250.82,
            251.16,
            251.5,
            251.85,
            252.19,
            252.53,
            252.87,
            253.22,
            253.56,
            253.9,
            254.24,
            254.59,
            254.93,
            255.27,
            255.61,
            255.95,
            256.29,
            256.63,
            258.98,
            257.32,
            257.66,
            258,
            258.34,
            258.68,
            259.02,
            259.36,
            259.7,
            260.04,
            260.38,
            260.72,
            261.06,
            261.4,
            261.74,
            262.08,
            262.42,
            262.76,
            263.1,
            263.43,
            236.77,
            264.11,
            264.45,
            264.79,
            265.13,
            265.46,
            265.8,
            266.14,
            266.48,
            266.82,
            267.15,
            267.49,
            267.83,
            268.17,
            268.5,
            268.84,
            269.18,
            269.51,
            269.85,
            270.19,
            270.52,
            270.86,
            271.2,
            271.53,
            271.87,
            272.2,
            272.54,
            272.88,
            273.21,
            273.55,
            273.88,
            274.22,
            274.55,
            274.89,
            275.22,
            275.56,
            275.89,
            276.23,
            276.56,
            276.89,
            277.23,
            277.56,
            277.9,
            278.23,
            278.56,
            278.9,
            279.23,
            279.56,
            279.9,
            280.23,
            280.56,
            280.9,
            281.23,
            281.56,
            281.89,
            282.23,
            282.56,
            282.89,
            283.22,
            283.55,
            283.89,
            284.22,
            284.55,
            284.88,
            285.21,
            285.54,
            285.87,
            286.21,
            286.54,
            286.87,
            287.2,
            287.53,
            287.86,
            288.19,
            288.52,
            288.85,
            289.18,
            289.51,
            289.84,
            290.17,
            290.5,
            290.83,
            291.16,
            291.49,
            291.81,
            292.14,
            292.47,
            292.8,
            293.13,
            293.46,
            293.79,
            294.11,
            294.44,
            294.77,
            295.1,
            295.43,
            295.75,
            296.08,
            296.41,
            296.74,
            297.06,
            297.39,
            297.72,
            298.04,
            298.37,
            298.7,
            299.02,
            299.35,
            299.68,
            300,
            300.33,
            300.65,
            300.98,
            301.31,
            301.63,
            301.96,
            302.28,
            302.61,
            302.93,
            303.26,
            303.58,
            303.91,
            304.23,
            304.56,
            304.88,
            305.2,
            305.53,
            305.85,
            306.18,
            306.5,
            306.82,
            307.15,
            307.47,
            307.79,
            308.12,
            308.44,
            308.76,
            309.09,
            309.41,
            309.73,
            310.05,
            310.38,
            310.7,
            311.02,
            311.34,
            311.66,
            311.99,
            312.31,
            312.63,
            312.95,
            313.27,
            313.59,
            313.91,
            314.24,
            314.56,
            314.88,
            315.2,
    };

    public static final int P100_START = -200;

    private double resistance;
    private double[] temperatureToOhmTable;
    private int temperatureStart;
    private TemperatureUnit temperatureUnit;


    public TemperatureConverter(double resistance, double[] temperatureToOhmTable, int temperatureStart, TemperatureUnit temperatureUnit)
    {
        this.resistance = resistance;
        this.temperatureToOhmTable = temperatureToOhmTable;
        this.temperatureStart = temperatureStart;
        this.temperatureUnit = temperatureUnit;
    }

    private double convertData(double temperature){
        switch (temperatureUnit)
        {
            case Celsius:
                return temperature;
            case Kelvin:
                return temperature + 273.15;
            case Fahrenheit:
                return temperature * (9.0 / 5.0) + 32.0;

                default:
                    throw new IllegalArgumentException("Invalid TemperatureUnit");
        }
    }

    @Override
    public Number getData(long data) {

        double Vout = data * (5.0 / 1023.0);
        double R2 = resistance / (5.0 / Vout - 1.0);

        int i = 0;

        for (double v:
                temperatureToOhmTable) {

            if (v > R2) return convertData(i + temperatureStart);

            i++;
        }

        throw new IndexOutOfBoundsException("Data exceeds conversion table");
    }
}
